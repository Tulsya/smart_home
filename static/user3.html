<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Home - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π</title>
    <script type="text/javascript"
        src="https://gc.kis.v2.scr.kaspersky-labs.com/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=6FP8TqQF6MbdkgFsagsxGRwfLcit1v-_elMP-4WUUVBo7glCLBX-drWAQAmuPEp8fa_qaULXC-nzqk_2F25NNVpBY7AckolHxsjxYgeScckKmTxF5aP3cgZd1mV78Ol9d8-E4ckhCu1DzV2ReMr06UriSjjgQTeNXmnb9FAnVy9IAsdOui-CTH_0gd21OFkB3d8QgzX7gEzKaBqRiH0YFN1_n6ntVSi8HkwQyzy4--UXtHwgu06IxsOXmnjarZU29-h85IArqswXe6LVo9YPLerxAvf1GeNTbSaZAAPS-oaLbLfb7ASz2I1eLlFfJAZhUZdedcri1XYcmRFaZ24y9fAvqW3lbWWq9YnskLU7IuczcvBO8S4mglE124-YfEE5nPnhXFGoRMndWl-Mj_Y9auSjui-tvXO-KJu9QhOJvyQI6nIHK8PIVjIiPuSc_VVtWmL-M85JoA4S3-ylCYlAoxWc-iOeN2ea6m5AyBiH0_MkGPAswStIGd4Pca_mVXe4GWTydXvI0Z3cg_U3kcqxsUFlEIwBpaZ3U5zth9NVD8I_EGxr9XfHXiO8Y0X8kqaERPx-XaSqFlCU6s3VjjRWbcP3Bpiw3suLmS7p6F_i4UQsqsJFE7dqW-QIVZ7qMR6KyBnxMF4_44d8oYhRMSa3rpCrO_MnJpr-ZlhdY8GXeL_ZklROlJMLR5mmgMS4mPK7P4_wR8AULfek_97440jucv8RCGapjY_RWSyP4la5coot_eQMMa7z2b9px8-oMW98B21_JsMXbr09W3OgMtfj53VP4JgfftYaFxMHKmDVV423JCertLlm381Y7V4bbZSp3N80PMvTv5KYIbYwk0_y7DYJC5uCARJMMa8voTDEcxa4LoIQU1fG48hgPNqp6a2Ob2NoHelHn_frLbSnR6pmXIacNs3ue5xkv25s-N2wSrbNvNzKNuzPRGBAURgZZ__oKO-oD1Wo47xVuwWzfZZ1uL69J_QKoudnsoN7VPBHvEq40XDYx71vNWE5LeEH0uZXepSEA6KoTQS-AZlTDPwMjT5KyxVbelcZyhmBSMPVFm8dyZmRqTS7T_tR9IHyWqdWq-ymt8iSsDfv7h-I5KrX8U3XQgquLvtb-rxLtjuJTjDZqoR4fbzLOlMHo7Lldgw5W1EocE2IXQpnGoTVPN763ewmnPVDzG8CFE22uKy8h7CAROX9jy-TP14tiAqsHcD7OIe2851f2FM8GXql1ZmmqUosIb6L5bOblyw5pm4WdzIXVdO0YQirlziGrdfZBUqSkJRJ4XdONfBr_uoSFw5q7_QYyNNHwb2mJHeZXL5RJyJx5DxoDK7CYshXJps5IvgHjQ8WvomL5-WTYUVcYNeJdNd7dMUtAXp6N_OAevaZML-UVWuXc3zQ-S3JfpY2Ax9_S1hRg0edPXvhVlncgpL-GaWYLegIQ0b7oCbKSdx8ywqaDqhOUZbmauvW7O2FXJqFBOGMPJqfT3FzWY3MtcApHjSJ1cG1Tgy6LuzaDvKhsvNDkW15fk54fs3M-48EvjnRFeIJPDx88CJrgPxn2wZRF96IMQmiwpJPr4DMB1tlQPo1DYmUq5gbn6z9aO7AgUxJlEF9r-iWpaISuXynyWlFCma_yU6stDlr4yDYvxKrhaRu8rZOJx6JGIIfWI6kOhqkIWhXxy-4M4c9tlmHXMYypreFPj-oSP0tidZSsz2FSvvFUGvczV8pk1TYPaXp3c8asGvxp4SVXyj9K5tl-_Cz1l1U3CtNJGNiKkRwYt0O6qALyM-gt2UFrCQsyn_VP2HcAlOYG15wRnPyke2zUwR9lE3bdb4c9TyrpoGHPe33g6y3cj7vLdxq_DER7iUWApAoyxcv5XVUdptnyxylz8ZlhJ5gohuqV0hjq-zHQRRZu26APA8e9uPlGM-PeR5N-_RoMKAD7ukMcnUXzvCfBlZSgA_Nn3qtseYITxzXsbu9X04nLf1LGsnE53oU9oylJs85GAuJvS_RGcng8vxhzZwJtXGrxCk7C0C8WUkU17P6KnEncYOY3I9nB1nYPUoSi1MZW5UyvCk3-_5wxqk1UE4OQd3m0o6s-qOieRvM8BxvSU_PS2-GzCCn6Gu0huKNiwQiOtBz8aANTxE6edH-yL8bbouoX1OyNb2mcCiZyhyl9hqgrJB3yfPtxUSssxypyJNCaJK4eDpZN6idLSc8BLg74QWQOJ0jvOemenv4o-NDXF42z5hS8aouCQXpsGevauhcPuUf7OdzhTW6NiQM6d_FRw"
        charset="UTF-8"></script>
    <title>Smart Home - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π</title>
    <link rel="stylesheet" href="profile-styles.css">
    <script type="text/javascript" src="..."></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
        }

        /* ============ AUTH PAGE ============ */
        .auth-page {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .auth-container {
            width: 100%;
            max-width: 400px;
        }

        .auth-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            padding: 40px;
        }

        .auth-card h1 {
            font-size: 28px;
            margin-bottom: 10px;
            color: #333;
            text-align: center;
        }

        .auth-card p {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .toggle-link {
            text-align: center;
            margin-top: 20px;
        }

        .toggle-link a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
        }

        .toggle-link a:hover {
            text-decoration: underline;
        }

        .alert {
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .hidden {
            display: none !important;
        }

        /* ============ USER PAGE ============ */
        .user-page {
            display: none;
        }

        .header {
            background: white;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #333;
            font-size: 24px;
        }

        .user-info-header {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info-header span {
            color: #666;
            font-size: 14px;
        }

        .logout-btn {
            background: #dc3545;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        .logout-btn:hover {
            background: #c82333;
        }

        .container-main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .step-card {
            background: white;
            border-radius: 8px;
            padding: 40px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .step-card h2 {
            color: #333;
            margin-bottom: 30px;
            font-size: 22px;
        }

        .step-card .step-number {
            display: inline-block;
            background: #667eea;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            text-align: center;
            line-height: 40px;
            margin-right: 15px;
            font-weight: bold;
            font-size: 18px;
        }

        .option-btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 15px 0;
            background: #f0f0f0;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            text-align: left;
        }

        .option-btn:hover {
            background: #e0e0e0;
            border-color: #667eea;
        }

        .option-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .input-file {
            display: block;
            margin: 20px 0;
            padding: 20px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .input-file:hover {
            border-color: #667eea;
            background: #f9f9f9;
        }

        .room-list {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .room-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: white;
            border-radius: 6px;
            margin: 8px 0;
        }

        .room-item-count {
            background: #667eea;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            text-align: center;
            line-height: 35px;
            font-weight: bold;
        }

        .navigation {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: space-between;
        }

        .btn-nav {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            background: #667eea;
            color: white;
            font-size: 16px;
        }

        .btn-nav:hover {
            background: #764ba2;
        }

        .btn-nav:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .json-output {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            font-family: monospace;
            font-size: 12px;
            overflow-x: auto;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
            color: #333;
        }

        .device-list {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .device-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 6px;
            margin: 10px 0;
            gap: 10px;
        }

        .device-item input,
        .device-item select {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .device-item-btn {
            background: #dc3545;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            white-space: nowrap;
        }

        .device-item-btn:hover {
            background: #c82333;
        }

        .save-btn {
            width: 100%;
            padding: 15px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            font-size: 16px;
        }

        .save-btn:hover {
            background: #218838;
        }

        .success-message {
            padding: 15px;
            background: #d4edda;
            color: #155724;
            border-radius: 6px;
            margin-top: 20px;
            display: none;
        }

        .success-message.show {
            display: block;
        }

        .step-indicator {
            text-align: center;
            margin-top: 30px;
            color: #666;
            font-size: 16px;
        }
    </style>
</head>

<body>
    <!-- ============ AUTH PAGE ============ -->
    <div id="authPage" class="auth-page">
        <div class="auth-container">
            <!-- –§–û–†–ú–ê –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò -->
            <div class="auth-card" id="registerCard">
                <h1>üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h1>
                <p>–°–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Smart Home</p>

                <div id="registerAlert"></div>

                <form id="registerForm">
                    <div class="form-group">
                        <label for="regUsername">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                        <input type="text" id="regUsername" name="username" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" required>
                    </div>

                    <div class="form-group">
                        <label for="regEmail">Email</label>
                        <input type="email" id="regEmail" name="email" placeholder="your@email.com" required>
                    </div>

                    <div class="form-group">
                        <label for="regPassword">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="regPassword" name="password" placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤"
                            required>
                    </div>

                    <button type="submit" class="btn btn-primary">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                </form>

                <div class="toggle-link">
                    –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a onclick="toggleForms()">–í–æ–π—Ç–∏</a>
                </div>
            </div>

            <!-- –§–û–†–ú–ê –õ–û–ì–ò–ù–ê -->
            <div class="auth-card hidden" id="loginCard">
                <h1>üîë –í—Ö–æ–¥</h1>
                <p>–í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç</p>

                <div id="loginAlert"></div>

                <form id="loginForm">
                    <div class="form-group">
                        <label for="loginUsername">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                        <input type="text" id="loginUsername" name="username" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" required>
                    </div>

                    <div class="form-group">
                        <label for="loginPassword">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="loginPassword" name="password" placeholder="–í–∞—à –ø–∞—Ä–æ–ª—å" required>
                    </div>

                    <button type="submit" class="btn btn-primary">–í–æ–π—Ç–∏</button>
                </form>

                <div class="toggle-link">
                    –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a onclick="toggleForms()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
                </div>
            </div>
        </div>
    </div>

    <!-- ============ USER PAGE ============ -->
    <div id="userPage" class="user-page">
        <!-- HEADER -->
        <div class="header">
            <h1>üè† –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Smart Home</h1>
            <div class="user-info-header">
                <span id="userDisplayName"></span>
                <!-- –ù–û–í–ê–Ø –ö–ù–û–ü–ö–ê –ü–†–û–§–ò–õ–Ø -->
                <button class="logout-btn" onclick="showProfilePage()" style="background: #667eea; margin-right: 10px;">
                    üë§ –ü—Ä–æ—Ñ–∏–ª—å
                </button>
                <button class="logout-btn" onclick="logout()">–í—ã—Ö–æ–¥</button>
            </div>
        </div>


        <!-- MAIN CONTENT -->
        <div class="container-main">

            <!-- –®–ê–ì 1: –í—ã–±–æ—Ä —Ç–∏–ø–∞ —Ä–∞—Å—á–µ—Ç–∞ -->
            <div id="step1" class="step-card">
                <h2>
                    <span class="step-number">1</span>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ä–∞—Å—á–µ—Ç–∞
                </h2>
                <button class="option-btn" onclick="selectPayment('–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è')">
                    ‚úì –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è (–ø–æ –ø–ª–æ—â–∞–¥–∏)
                </button>
                <button class="option-btn" onclick="selectPayment('–ü–æ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—é')">
                    ‚úì –ü–æ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—é
                </button>
                <button class="option-btn" onclick="selectPayment('–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è')">
                    ‚úì –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è
                </button>
                <button class="btn btn-primary" style="margin-top: 30px;" onclick="nextStep(1)">
                    –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å ‚Üí
                </button>
            </div>

            <!-- –®–ê–ì 2: –ü–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ –∏ –∫–æ–º–Ω–∞—Ç—ã -->
            <div id="step2" class="step-card hidden">
                <h2>
                    <span class="step-number">2</span>
                    –ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–Ω–∞—Ç—ã
                </h2>

                <!-- ‚úÖ –ö–ù–û–ü–ö–ê –ó–ê–ì–†–£–ó–ö–ò –§–û–¢–û -->
                <div style="margin: 20px 0;">
                    <button type="button" class="btn btn-primary"
                        onclick="document.getElementById('floorplanImage').click();"
                        style="width: 100%; cursor: pointer;">
                        üìÅ –í—ã–±—Ä–∞—Ç—å —Ñ–æ—Ç–æ –∫–≤–∞—Ä—Ç–∏—Ä—ã
                    </button>

                    <!-- HIDDEN INPUT - –µ–≥–æ –ù–ï –≤–∏–¥–Ω–æ, –Ω–æ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ onclick -->
                    <input type="file" id="floorplanImage" accept="image/*" onchange="previewImage()">
                    <div id="floorplanPreview" class="floorplan-preview">
                        üì∑ –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
                    </div>

                </div>

                <!-- –ü–†–ï–í–¨–Æ –§–û–¢–û (–±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ JavaScript) -->
                <!-- <div id="floorplanPreview">...</div> -->

                <!-- –°–û–û–ë–©–ï–ù–ò–ï –û–ë –û–®–ò–ë–ö–ï -->
                <div id="uploadError" style="margin: 10px 0;"></div>

                <!-- –í–´–ë–û–† –ö–û–õ–ò–ß–ï–°–¢–í–ê –ö–û–ú–ù–ê–¢ -->
                <p style="margin-top: 30px; font-weight: bold; color: #333;">
                    üí° –õ–µ–≤—ã–π –∫–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ - –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–Ω–∞—Ç—É
                </p>

                <div class="room-list">
                    <strong>–ö–æ–º–Ω–∞—Ç—ã –Ω–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–µ:</strong>

                    <div class="room-item">
                        <span>üõãÔ∏è –ì–æ—Å—Ç–∏–Ω–∞—è</span>
                        <div class="room-item-count" id="livingRoomCount">0</div>
                        <button type="button" class="option-btn" style="flex: 0; width: 100px; margin: 0; padding: 8px;"
                            onclick="incrementRoom('livingroom')">
                            ‚ûï –î–æ–±–∞–≤–∏—Ç—å
                        </button>
                        <button type="button" class="option-btn" style="flex: 0; width: 100px; margin: 0; padding: 8px;"
                            onclick="decrementRoom('livingroom')">
                            ‚ûñ –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </div>

                    <div class="room-item">
                        <span>üõèÔ∏è –°–ø–∞–ª—å–Ω—è</span>
                        <div class="room-item-count" id="bedroomCount">0</div>
                        <button type="button" class="option-btn" style="flex: 0; width: 100px; margin: 0; padding: 8px;"
                            onclick="incrementRoom('bedroom')">
                            ‚ûï –î–æ–±–∞–≤–∏—Ç—å
                        </button>
                        <button type="button" class="option-btn" style="flex: 0; width: 100px; margin: 0; padding: 8px;"
                            onclick="decrementRoom('bedroom')">
                            ‚ûñ –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </div>

                    <div class="room-item">
                        <span>üç≥ –ö—É—Ö–Ω—è</span>
                        <div class="room-item-count" id="kitchenCount">0</div>
                        <button type="button" class="option-btn" style="flex: 0; width: 100px; margin: 0; padding: 8px;"
                            onclick="incrementRoom('kitchen')">
                            ‚ûï –î–æ–±–∞–≤–∏—Ç—å
                        </button>
                        <button type="button" class="option-btn" style="flex: 0; width: 100px; margin: 0; padding: 8px;"
                            onclick="decrementRoom('kitchen')">
                            ‚ûñ –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </div>

                    <div class="room-item">
                        <span>üö™ –ö–æ—Ä–∏–¥–æ—Ä</span>
                        <div class="room-item-count" id="hallwayCount">0</div>
                        <button type="button" class="option-btn" style="flex: 0; width: 100px; margin: 0; padding: 8px;"
                            onclick="incrementRoom('hallway')">
                            ‚ûï –î–æ–±–∞–≤–∏—Ç—å
                        </button>
                        <button type="button" class="option-btn" style="flex: 0; width: 100px; margin: 0; padding: 8px;"
                            onclick="decrementRoom('hallway')">
                            ‚ûñ –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </div>

                    <div class="room-item">
                        <span>üå§Ô∏è –ë–∞–ª–∫–æ–Ω</span>
                        <div class="room-item-count" id="balconyCount">0</div>
                        <button type="button" class="option-btn" style="flex: 0; width: 100px; margin: 0; padding: 8px;"
                            onclick="incrementRoom('balcony')">
                            ‚ûï –î–æ–±–∞–≤–∏—Ç—å
                        </button>
                        <button type="button" class="option-btn" style="flex: 0; width: 100px; margin: 0; padding: 8px;"
                            onclick="decrementRoom('balcony')">
                            ‚ûñ –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </div>

                    <div class="room-item">
                        <span>üöø –í–∞–Ω–Ω–∞—è</span>
                        <div class="room-item-count" id="bathroomCount">0</div>
                        <button type="button" class="option-btn" style="flex: 0; width: 100px; margin: 0; padding: 8px;"
                            onclick="incrementRoom('bathroom')">
                            ‚ûï –î–æ–±–∞–≤–∏—Ç—å
                        </button>
                        <button type="button" class="option-btn" style="flex: 0; width: 100px; margin: 0; padding: 8px;"
                            onclick="decrementRoom('bathroom')">
                            ‚ûñ –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </div>
                </div>

                <!-- JSON –°–¢–†–£–ö–¢–£–†–ê -->
                <strong style="display: block; margin-top: 20px;">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ (JSON):</strong>
                <div class="json-output" id="jsonFloorplan">
                    { "rooms": {} }
                </div>

                <!-- –ù–ê–í–ò–ì–ê–¶–ò–Ø -->
                <div class="navigation">
                    <button type="button" class="btn-nav" onclick="prevStep(2)">‚Üê –ù–∞–∑–∞–¥</button>
                    <button type="button" class="btn-nav" onclick="nextStep(2)">–î–∞–ª–µ–µ ‚Üí</button>
                </div>
            </div>

            <!-- –®–ê–ì 3: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ -->
            <div id="step3" class="step-card hidden">
                <h2>
                    <span class="step-number">3</span>–î–æ–±–∞–≤—å—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
                </h2>

                <button class="btn btn-primary" onclick="addDevice()" style="margin-bottom: 20px;">
                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
                </button>

                <div class="device-list" id="deviceList">
                    <p style="color: #999; text-align: center;">–ù–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤</p>
                </div>

                <button class="save-btn" onclick="saveConfiguration()">
                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É
                </button>

                <div class="success-message" id="successMessage">
                    ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!
                </div>

                <div class="navigation">
                    <button class="btn-nav" onclick="prevStep(3)" style="flex: 1;">‚Üê –ù–∞–∑–∞–¥</button>
                </div>
            </div>

            <!-- PROGRESS INDICATOR -->
            <div class="step-indicator">
                <p>–®–∞–≥ <span id="currentStep">1</span>/3</p>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8082/api/auth';
        const API_USER_SETUP = 'http://localhost:8082/api/user/setup';

        // ============ AUTHENTICATION ============

        window.addEventListener('load', () => {
            const savedUser = localStorage.getItem('user');
            if (savedUser) {
                showUserPage(JSON.parse(savedUser));
            }
        });

        function toggleForms() {
            document.getElementById('registerCard').classList.toggle('hidden');
            document.getElementById('loginCard').classList.toggle('hidden');
            document.getElementById('registerAlert').innerHTML = '';
            document.getElementById('loginAlert').innerHTML = '';
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const username = document.getElementById('regUsername').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;

            try {
                const response = await fetch(`${API_BASE}/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, email, password })
                });

                const data = await response.json();

                if (!response.ok) {
                    showAlert('registerAlert', data.message || '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏', 'error');
                    return;
                }

                showAlert('registerAlert', '‚úì –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!', 'success');
                localStorage.setItem('user', JSON.stringify(data));

                setTimeout(() => {
                    showUserPage(data);
                }, 1000);

            } catch (error) {
                showAlert('registerAlert', '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
            }
        });

        // –í—Ö–æ–¥
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const response = await fetch(`${API_BASE}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (!response.ok) {
                    showAlert('loginAlert', '–ù–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ', 'error');
                    return;
                }

                showAlert('loginAlert', '‚úì –í—Ö–æ–¥ —É—Å–ø–µ—à–µ–Ω!', 'success');
                localStorage.setItem('user', JSON.stringify(data));

                setTimeout(() => {
                    showUserPage(data);
                }, 1000);

            } catch (error) {
                showAlert('loginAlert', '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
            }
        });

        function showAlert(elementId, message, type) {
            const alertDiv = document.getElementById(elementId);
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
        }

        // ============ USER PAGE ============

        let userSetupData = {
            paymentType: '',
            floorplan: null,
            rooms: {},
            devices: []
        };

        function showUserPage(userData) {
            currentUser = userData;
            document.getElementById('authPage').style.display = 'none';
            document.getElementById('userPage').style.display = 'block';
            document.getElementById('userDisplayName').textContent = `üë§ ${userData.username}`;
            showStep(1);
        }

        function logout() {
            localStorage.removeItem('user');
            currentUser = null;
            userSetupData = {
                paymentType: '',
                floorplan: null,
                rooms: {},
                devices: []
            };
            document.getElementById('authPage').style.display = 'flex';
            document.getElementById('userPage').style.display = 'none';
            document.getElementById('registerForm').reset();
            document.getElementById('loginForm').reset();
            document.getElementById('registerCard').classList.remove('hidden');
            document.getElementById('loginCard').classList.add('hidden');
        }

        // –®–ê–ì 1: –í—ã–±–æ—Ä —Ç–∏–ø–∞ —Ä–∞—Å—á–µ—Ç–∞
        function selectPayment(type) {
            userSetupData.paymentType = type;
            document.querySelectorAll('#step1 .option-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent.includes(type));
            });
        }

        // –®–ê–ì 2: –ö–æ–º–Ω–∞—Ç—ã
        function incrementRoom(roomId) {
            userSetupData.rooms[roomId] = (userSetupData.rooms[roomId] || 0) + 1;
            updateRoomCounts();
            updateJsonFloorplan();
        }

        function decrementRoom(roomId) {
            if (userSetupData.rooms[roomId] > 0) {
                userSetupData.rooms[roomId]--;
                updateRoomCounts();
                updateJsonFloorplan();
            }
        }

        function updateRoomCounts() {
            const roomMap = {
                'livingroom': 'livingRoomCount',
                'bedroom': 'bedroomCount',
                'kitchen': 'kitchenCount',
                'hallway': 'hallwayCount',
                'balcony': 'balconyCount',
                'bathroom': 'bathroomCount'
            };

            Object.entries(roomMap).forEach(([key, elementId]) => {
                document.getElementById(elementId).textContent = userSetupData.rooms[key] || 0;
            });
        }

        function updateJsonFloorplan() {
            document.getElementById('jsonFloorplan').textContent =
                JSON.stringify({ rooms: userSetupData.rooms }, null, 2);
        }

        // –®–ê–ì 3: –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
        let deviceCounter = 0;

        function addDevice() {
            deviceCounter++;
            const deviceId = `device-${deviceCounter}`;
            userSetupData.devices.push({
                id: deviceId,
                name: '',
                type: '',
                room: ''
            });
            renderDevices();
        }

        function removeDevice(deviceId) {
            userSetupData.devices = userSetupData.devices.filter(d => d.id !== deviceId);
            renderDevices();
        }

        function updateDevice(deviceId, field, value) {
            const device = userSetupData.devices.find(d => d.id === deviceId);
            if (device) {
                device[field] = value;
            }
        }

        function renderDevices() {
            const deviceList = document.getElementById('deviceList');

            if (userSetupData.devices.length === 0) {
                deviceList.innerHTML = '<p style="color: #999; text-align: center;">–ù–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤</p>';
                return;
            }

            deviceList.innerHTML = userSetupData.devices.map(device => `
                <div class="device-item">
                    <input 
                        type="text" 
                        placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" 
                        value="${device.name}"
                        onchange="updateDevice('${device.id}', 'name', this.value)"
                    />
                    <select 
                        onchange="updateDevice('${device.id}', 'type', this.value)"
                    >
                        <option value="">–¢–∏–ø</option>
                        <option value="sensor" ${device.type === 'sensor' ? 'selected' : ''}>–î–∞—Ç—á–∏–∫</option>
                        <option value="actuator" ${device.type === 'actuator' ? 'selected' : ''}>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</option>
                        <option value="controller" ${device.type === 'controller' ? 'selected' : ''}>–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä</option>
                    </select>
                    <select 
                        onchange="updateDevice('${device.id}', 'room', this.value)"
                    >
                        <option value="">–ö–æ–º–Ω–∞—Ç–∞</option>
                        <option value="living_room" ${device.room === 'living_room' ? 'selected' : ''}>–ì–æ—Å—Ç–∏–Ω–∞—è</option>
                        <option value="bedroom" ${device.room === 'bedroom' ? 'selected' : ''}>–°–ø–∞–ª—å–Ω—è</option>
                        <option value="kitchen" ${device.room === 'kitchen' ? 'selected' : ''}>–ö—É—Ö–Ω—è</option>
                        <option value="hallway" ${device.room === 'hallway' ? 'selected' : ''}>–ö–æ—Ä–∏–¥–æ—Ä</option>
                        <option value="balcony" ${device.room === 'balcony' ? 'selected' : ''}>–ë–∞–ª–∫–æ–Ω</option>
                        <option value="bathroom" ${device.room === 'bathroom' ? 'selected' : ''}>–°–∞–Ω—É–∑–µ–ª</option>
                    </select>
                    <button type="button" class="device-item-btn" onclick="removeDevice('${device.id}')">
                        –£–¥–∞–ª–∏—Ç—å
                    </button>
                </div>
            `).join('');
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è
        function showStep(stepNum) {
            document.getElementById('step1').classList.toggle('hidden', stepNum !== 1);
            document.getElementById('step2').classList.toggle('hidden', stepNum !== 2);
            document.getElementById('step3').classList.toggle('hidden', stepNum !== 3);
            document.getElementById('currentStep').textContent = stepNum;
        }

        function nextStep(currentStep) {
            if (currentStep === 1) {
                if (!userSetupData.paymentType) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ä–∞—Å—á–µ—Ç–∞');
                    return;
                }
            }
            if (currentStep < 3) {
                showStep(currentStep + 1);
            }
        }

        function prevStep(currentStep) {
            if (currentStep > 1) {
                showStep(currentStep - 1);
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        async function saveConfiguration() {
            if (!currentUser) {
                alert('–í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã');
                return;
            }

            if (userSetupData.devices.length === 0) {
                alert('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ');
                return;
            }

            try {
                const response = await fetch(API_USER_SETUP, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_id: currentUser.id,
                        device_id: 1,
                        payment_type: userSetupData.paymentType,
                        floorplan: JSON.stringify({
                            rooms: userSetupData.rooms,
                            devices: userSetupData.devices
                        })
                    })
                });

                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                }

                const data = await response.json();
                console.log('–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞:', data);

                // –ü–æ–∫–∞–∑–∞—Ç—å —É—Å–ø–µ—à–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                const successMsg = document.getElementById('successMessage');
                successMsg.classList.add('show');
                setTimeout(() => {
                    successMsg.classList.remove('show');
                }, 3000);

            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: ' + error.message);
            }
        }
        let floorplanImageData = null;

        function previewImage() {
            const file = document.getElementById('floorplanImage').files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                floorplanImageData = e.target.result;        // base64
                userSetupData.floorplan = floorplanImageData; // —á—Ç–æ–±—ã —É—à–ª–æ –Ω–∞ –±—ç–∫–µ–Ω–¥

                document.getElementById('floorplanPreview').innerHTML =
                    `<img src="${floorplanImageData}" alt="–ü–ª–∞–Ω–∏—Ä–æ–≤–∫–∞" style="max-width:100%;max-height:300px;border-radius:6px;">`;
            };
            reader.readAsDataURL(file);
        }

    </script>

    <!-- –§–£–ù–ö–¶–ò–ò –ù–ê–í–ò–ì–ê–¶–ò–ò –ü–†–û–§–ò–õ–Ø -->
    <div id="profilePage" class="user-page" style="display: none;">
        <div class="header">
            <h1>Smart Home - –ú–æ–π –ü—Ä–æ—Ñ–∏–ª—å</h1>
            <div class="user-info-header">
                <span id="profileUsername"></span>
                <button class="logout-btn" onclick="goBackToSetup()" style="background: #667eea; margin-right: 10px;">‚Üê
                    –í–µ—Ä–Ω—É—Ç—å—Å—è</button>
                <button class="logout-btn" onclick="logout()">–í—ã—Ö–æ–¥</button>
            </div>
        </div>

        <div class="container-main">
            <div class="step-card">
                <h2><span class="step-number">‚öôÔ∏è</span> –ú–æ–π –ü—Ä–æ—Ñ–∏–ª—å</h2>

                <!-- –°–¢–ê–¢–£–° –î–û–ú–ê -->
                <div style="margin: 20px 0;">
                    <label style="font-weight: bold; color: #333; margin-bottom: 10px; display: block;">–°—Ç–∞—Ç—É—Å
                        –¥–æ–º–∞:</label>
                    <select id="houseStatusSelect"
                        style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞—Ç—É—Å</option>
                        <option value="–î–µ–Ω—å">–î–µ–Ω—å</option>
                        <option value="–ù–æ—á—å">–ù–æ—á—å</option>
                        <option value="–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ">–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ</option>
                    </select>
                </div>

                <!-- –¢–ò–ü –û–ü–õ–ê–¢–´ -->
                <div style="margin: 20px 0;">
                    <label style="font-weight: bold; color: #333; margin-bottom: 10px; display: block;">–¢–∏–ø
                        –æ–ø–ª–∞—Ç—ã:</label>
                    <select id="paymentTypeSelect"
                        style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
                        <option value="–ë–∞–∑–æ–≤—ã–π">–ë–∞–∑–æ–≤—ã–π</option>
                        <option value="–°—Ç–∞–Ω–¥–∞—Ä—Ç">–°—Ç–∞–Ω–¥–∞—Ä—Ç</option>
                        <option value="–ü—Ä–µ–º–∏—É–º">–ü—Ä–µ–º–∏—É–º</option>
                    </select>
                </div>

                <!-- –ü–õ–ê–ù–ò–†–û–í–ö–ê -->
                <div style="margin: 20px 0;">
                    <label style="font-weight: bold; color: #333; margin-bottom: 10px; display: block;">–§–æ—Ç–æ
                        –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏:</label>
                    <input type="file" id="floorplanImageInput" accept="image/*"
                        style="display: block; margin: 10px 0;">
                    <div id="floorplanImagePreview" style="margin-top: 10px;"></div>
                </div>

                <!-- –ö–ù–û–ü–ö–ê –°–û–•–†–ê–ù–ï–ù–ò–Ø -->
                <button class="save-btn" onclick="saveProfileChanges()" style="margin-top: 20px;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>

                <!-- –°–û–û–ë–©–ï–ù–ò–ï –û –£–°–ü–ï–•–ï -->
                <div class="success-message" id="profileSuccessMessage" style="margin-top: 20px;">
                    ‚úÖ –ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!
                </div>

                <!-- –ò–ù–§–û–†–ú–ê–¶–ò–Ø –ü–û –ü–†–û–§–ò–õ–Æ -->
                <div style="margin-top: 30px; background: #f9f9f9; padding: 15px; border-radius: 8px;">
                    <p><strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> <span id="profileDisplayUsername"></span></p>
                    <p><strong>Email:</strong> <span id="profileDisplayEmail"></span></p>
                    <p><strong>–°—Ç–∞—Ç—É—Å –¥–æ–º–∞:</strong> <span id="profileDisplayHouseStatus">-</span></p>
                    <p><strong>–¢–∏–ø –æ–ø–ª–∞—Ç—ã:</strong> <span id="profileDisplayPaymentType">-</span></p>
                    <p><strong>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</strong> <span id="profileDisplayCreatedAt">-</span></p>
                </div>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT -->
    <script>
        let currentUser = null;

        function showProfilePage() {
            document.getElementById("authPage").style.display = "none";
            document.getElementById("userPage").style.display = "none";
            document.getElementById("profilePage").style.display = "block";
            loadProfileData();
        }

        function goBackToSetup() {
            document.getElementById("profilePage").style.display = "none";
            document.getElementById("userPage").style.display = "block";
            showStep(1);
        }

        async function loadProfileData() {
            try {
                const user = JSON.parse(localStorage.getItem("user"));
                if (!user) return;

                // –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è —Å —Å–µ—Ä–≤–µ—Ä–∞
                const response = await fetch(`http://localhost:8082/api/auth/profile?id=${user.id}`);
                const profile = await response.json();

                // –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—ã
                document.getElementById("profileUsername").textContent = profile.username;
                document.getElementById("profileDisplayUsername").textContent = profile.username;
                document.getElementById("profileDisplayEmail").textContent = profile.email;
                document.getElementById("profileDisplayHouseStatus").textContent = profile.house_status || "–ù–µ —É–∫–∞–∑–∞–Ω";
                document.getElementById("profileDisplayPaymentType").textContent = profile.payment_type || "–ù–µ —É–∫–∞–∑–∞–Ω";
                document.getElementById("profileDisplayCreatedAt").textContent = new Date(profile.created_at).toLocaleDateString("ru-RU");

                // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Å–µ–ª–µ–∫—Ç—ã
                if (profile.house_status) {
                    document.getElementById("houseStatusSelect").value = profile.house_status;
                }
                if (profile.payment_type) {
                    document.getElementById("paymentTypeSelect").value = profile.payment_type;
                }

                currentUser = user;
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è:", error);
            }
        }

        async function saveProfileChanges() {
            if (!currentUser) return;

            const houseStatus = document.getElementById("houseStatusSelect").value;
            const paymentType = document.getElementById("paymentTypeSelect").value;
            const floorplanFile = document.getElementById("floorplanImageInput").files[0];

            try {
                // 1. –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∏ —Ç–∏–ø –æ–ø–ª–∞—Ç—ã (–ë–ï–ó –∫–∞—Ä—Ç–∏–Ω–∫–∏)
                const profileRes = await fetch(
                    `http://localhost:8082/api/user/profile?id=${currentUser.id}`,
                    {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            housestatus: houseStatus,
                            paymenttype: paymentType
                            // floorplanimage –Ω–µ —à–ª—ë–º
                        })
                    }
                );

                if (!profileRes.ok) {
                    throw new Error("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è");
                }

                // 2. –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∞ ‚Äì –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å multipart –Ω–∞ /api/user/floorplan
                if (floorplanFile) {
                    const formData = new FormData();
                    formData.append("floorplan", floorplanFile);

                    const uploadRes = await fetch(
                        `http://localhost:8082/api/user/floorplan?id=${currentUser.id}`,
                        {
                            method: "POST",
                            body: formData
                        }
                    );

                    if (!uploadRes.ok) {
                        throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏");
                    }
                }

                // 3. –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è
                const successMsg = document.getElementById("profileSuccessMessage");
                if (successMsg) {
                    successMsg.style.display = "block";
                    setTimeout(() => {
                        successMsg.style.display = "none";
                    }, 3000);
                }

                await loadProfileData();
            } catch (error) {
                alert(error.message || "–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è");
                console.error("Profile save error:", error);
            }
        }


        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
        window.addEventListener("load", () => {
            const savedUser = localStorage.getItem("user");
            if (savedUser) currentUser = JSON.parse(savedUser);
        });
    </script>

</body>

</html>