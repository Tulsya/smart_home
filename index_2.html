<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Home - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π</title>
    <script type="text/javascript" src="https://gc.kis.v2.scr.kaspersky-labs.com/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=rvOfU_kyK8xEAO2gHYRpqcihAgcgeBZ0CF0Y7CE_6g9jA-jZZxFBju5O26RrrDYflioLPrmdGfAmZj7T8TAJErRY21zKAaq71zO2DnIIKAo7jcSKF2kZ48ceaPZR3a0Lojg9sYiPrs2uHWghRktciblo4DQBC7sBNM6k-JljLEiz5X0a_0yRmmXZBixWE96uNubpvZQ-RYBfvlHgaFVP_4XYAHdF5I6wComQDyYgzLSJoJTJlV7p4SrIeD5JI1z5bJbOyRlKywhg7cPXzDc5jCXiRVCAeyxyxZGozlRvn0aNn8lbJVsJTl76A6YOU7qIV8QcFv2oEDULhmiyNZa3EKhl5O245ma7vSF6c3-HwAotcrBjDid6Qec7tOhbZylaN3KuyQ6LtvWsKolcjRcpZQGEZFWdy9PWfinadcy2L9jdxISmib5TsqTKH7oxLxxGDyDu9xATT-uASFPBFY9yPlhWRI3aUeVcDdfJzxFI4NiXxKZdG1hg1elTg0OkrEWtPRlhX-4tg_99tihqoer-Xm1COsE9RUND64NR6ZW1DuXYJgw4xVvZ6dG2UM3uPW64CWRHLg6inzCqWazP2qYUos0l5hxKhH-YAAJEcR-oARqj8_XeAToe9YETamXFiV_JXAUu4rLOVy1U-_4skKF2sGL4TSIIIHtzkpuQ8e_ZkjOP0vASC4tL1kY-DUW2HGnFPM_-qsnsiAM8knAspOR-ditDIoAQQYV8eXWO2vkYxqmY-2PmGJo8sLsP3SHPpOPy3NSeNck4DEgLuvfyTon8r17hh9g8EwrbgWn8i80pxPiCPOu6bZeUns9ZQd_tHuO1ql91FYiKxgnYMjVILsSSYf0j2mNe6kPrtydCUbeut3K5xZJqeVF8HKWa6LoDk5esi42u9rTjQpM9VnzzcBmUTpQIdegEJVBNpZoXawMVTrWHkZ-v4uELCQZAWXA3JHx2V9Wsh9B822uiKSTgwNPqSHY0uJ6JFMROtvhrRheysG1PnKiHdYOPgMl9j7zt7UTJJMYmcb6pWbO1bWDlVAOXFC3P9chTFAOdDghHV0QsBbGEIRcAA0bP5iiqjTEomsnMarivrKvu14VPnkmkAkk0Gft5IZ0hmW8bBr3f67utUsXzdE1K4TCUD479IQDABE1tkGcTL-mIHlOJDSDI9no6vZqK1P0cnlLsOuEOktsDxfsFcONbVwKRVqvOghnXYN22lryyTfkiSMraelTVO0BHcTlake1ZkCEc9BmeaVIVAE0xTdlQyEFnEl3kkX66a6QctJ-BsDlsaIRP1Yo1xhD34cjFVMLnP8Yf3ZOOklH6C4Dv0N_E2z83RngAwGZi23HYNA09CO7Zwp9DnVaQXS4BNFQ5D68zl-fKJ8NEw05jSpBbFunStTlQ3ManfV6S1EkfmH3LU3Uuo31puqNqbCeggLL770HnbxXjlXnkzWHBXlFsE5S_0DmUrKLgcKrGKvr3JahU6Mt2JG4idxLmM61g_L1uPpW_gbblVrBt4yUsSAMeW6q5i86QHIj6xAhHz2vr7bZbvRhEibtjyXbO68CC-J4eLPH1lquL0CCSVBi7EHtMkq46dyfJMCiqq9sHbSVRMTODE4Z8ui7hY-Xmz6Oq14oq-yhxOlgZ-NTO5MbzOg92T9ArEAcZ9ukvy6P_f_GETckuv2BHolplRnxAST0P1u0cy-Fv5QpYlHX1-qaU0_xvcC_5iEZf0ot_Jw0tlWLT7-F68SYCvAzvWHqvj2E-4KWtRJDd7rPq63TVGO8Nm_vtFp1RBaCpfkUjK1A4BSv60yyxBoW81-ZT5RJQfGnHCEwlbjiRU4bdT4QqjrEXThQWD9OWkeC58aKnUSFECYoI16NanJ_aeK376rkkygTsH96eVWRozwKgw5-cbxlNB0sPsSvbiWNzSOPtBdKUa1JXzVW7fvckIpnnIRJVgE30JpEveTYVuLC9RRSiUrYhJBnIaXVPUm1mxzQzhGt_ivLwmsnhCEm1kPQzn0-NJ-Z1iyWcwS71Z6d-ABAyFqhdNQl4oSAn7BGAa3wMjvcpNWZNmhofLN7_6uVBmo3_F6ovbKTgHxVAwQsZnLOUq48SsB-hNOkI-9SoH7r1R932jNbFk1_PPpSOjFS9LaRuc5PCti5fr1kTWvs1qd2bNkp57nQ43t8Llhhupob72VZE6sKa1YeJTlPLtudm5uTHQuJsoOMFNlK534vp_W8xNBn0O1jrsY3UsQdi3p9XzxzqI5CBcQsQyFvNClrp1guo840m_26H3mQ88piBcp_LCneHFSc" charset="UTF-8"></script><style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
        }

        /* ============ AUTH PAGE ============ */
        .auth-page {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .auth-container {
            width: 100%;
            max-width: 400px;
        }

        .auth-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            padding: 40px;
        }

        .auth-card h1 {
            font-size: 28px;
            margin-bottom: 10px;
            color: #333;
            text-align: center;
        }

        .auth-card p {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .toggle-link {
            text-align: center;
            margin-top: 20px;
        }

        .toggle-link a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
        }

        .toggle-link a:hover {
            text-decoration: underline;
        }

        .alert {
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .hidden {
            display: none !important;
        }

        /* ============ USER PAGE ============ */
        .user-page {
            display: none;
        }

        .header {
            background: white;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #333;
            font-size: 24px;
        }

        .user-info-header {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info-header span {
            color: #666;
            font-size: 14px;
        }

        .logout-btn {
            background: #dc3545;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        .logout-btn:hover {
            background: #c82333;
        }

        .container-main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .step-card {
            background: white;
            border-radius: 8px;
            padding: 40px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .step-card h2 {
            color: #333;
            margin-bottom: 30px;
            font-size: 22px;
        }

        .step-card .step-number {
            display: inline-block;
            background: #667eea;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            text-align: center;
            line-height: 40px;
            margin-right: 15px;
            font-weight: bold;
            font-size: 18px;
        }

        .option-btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 15px 0;
            background: #f0f0f0;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            text-align: left;
        }

        .option-btn:hover {
            background: #e0e0e0;
            border-color: #667eea;
        }

        .option-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .input-file {
            display: block;
            margin: 20px 0;
            padding: 20px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .input-file:hover {
            border-color: #667eea;
            background: #f9f9f9;
        }

        .room-list {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .room-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: white;
            border-radius: 6px;
            margin: 8px 0;
        }

        .room-item-count {
            background: #667eea;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            text-align: center;
            line-height: 35px;
            font-weight: bold;
        }

        .navigation {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: space-between;
        }

        .btn-nav {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            background: #667eea;
            color: white;
            font-size: 16px;
        }

        .btn-nav:hover {
            background: #764ba2;
        }

        .btn-nav:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .json-output {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            font-family: monospace;
            font-size: 12px;
            overflow-x: auto;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
            color: #333;
        }

        .device-list {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .device-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 6px;
            margin: 10px 0;
            gap: 10px;
        }

        .device-item input,
        .device-item select {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .device-item-btn {
            background: #dc3545;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            white-space: nowrap;
        }

        .device-item-btn:hover {
            background: #c82333;
        }

        .save-btn {
            width: 100%;
            padding: 15px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            font-size: 16px;
        }

        .save-btn:hover {
            background: #218838;
        }

        .success-message {
            padding: 15px;
            background: #d4edda;
            color: #155724;
            border-radius: 6px;
            margin-top: 20px;
            display: none;
        }

        .success-message.show {
            display: block;
        }

        .step-indicator {
            text-align: center;
            margin-top: 30px;
            color: #666;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <!-- ============ AUTH PAGE ============ -->
    <div id="authPage" class="auth-page">
        <div class="auth-container">
            <!-- –§–û–†–ú–ê –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò -->
            <div class="auth-card" id="registerCard">
                <h1>üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h1>
                <p>–°–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Smart Home</p>

                <div id="registerAlert"></div>

                <form id="registerForm">
                    <div class="form-group">
                        <label for="regUsername">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                        <input type="text" id="regUsername" name="username" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" required>
                    </div>

                    <div class="form-group">
                        <label for="regEmail">Email</label>
                        <input type="email" id="regEmail" name="email" placeholder="your@email.com" required>
                    </div>

                    <div class="form-group">
                        <label for="regPassword">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="regPassword" name="password" placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤" required>
                    </div>

                    <button type="submit" class="btn btn-primary">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                </form>

                <div class="toggle-link">
                    –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a onclick="toggleForms()">–í–æ–π—Ç–∏</a>
                </div>
            </div>

            <!-- –§–û–†–ú–ê –õ–û–ì–ò–ù–ê -->
            <div class="auth-card hidden" id="loginCard">
                <h1>üîë –í—Ö–æ–¥</h1>
                <p>–í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç</p>

                <div id="loginAlert"></div>

                <form id="loginForm">
                    <div class="form-group">
                        <label for="loginUsername">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                        <input type="text" id="loginUsername" name="username" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" required>
                    </div>

                    <div class="form-group">
                        <label for="loginPassword">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="loginPassword" name="password" placeholder="–í–∞—à –ø–∞—Ä–æ–ª—å" required>
                    </div>

                    <button type="submit" class="btn btn-primary">–í–æ–π—Ç–∏</button>
                </form>

                <div class="toggle-link">
                    –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a onclick="toggleForms()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
                </div>
            </div>
        </div>
    </div>

    <!-- ============ USER PAGE ============ -->
    <div id="userPage" class="user-page">
        <!-- HEADER -->
        <div class="header">
            <h1>üè† –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Smart Home</h1>
            <div class="user-info-header">
                <span id="userDisplayName"></span>
                <button class="logout-btn" onclick="logout()">–í—ã—Ö–æ–¥</button>
            </div>
        </div>

        <!-- MAIN CONTENT -->
        <div class="container-main">

            <!-- –®–ê–ì 1: –í—ã–±–æ—Ä —Ç–∏–ø–∞ —Ä–∞—Å—á–µ—Ç–∞ -->
            <div id="step1" class="step-card">
                <h2>
                    <span class="step-number">1</span>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ä–∞—Å—á–µ—Ç–∞
                </h2>
                <button class="option-btn" onclick="selectPayment('–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è')">
                    ‚úì –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è (–ø–æ –ø–ª–æ—â–∞–¥–∏)
                </button>
                <button class="option-btn" onclick="selectPayment('–ü–æ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—é')">
                    ‚úì –ü–æ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—é
                </button>
                <button class="option-btn" onclick="selectPayment('–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è')">
                    ‚úì –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è
                </button>
                <button class="btn btn-primary" style="margin-top: 30px;" onclick="nextStep(1)">
                    –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å ‚Üí
                </button>
            </div>

            <!-- –®–ê–ì 2: –ü–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ –∏ –∫–æ–º–Ω–∞—Ç—ã -->
            <div id="step2" class="step-card hidden">
                <h2>
                    <span class="step-number">2</span>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–Ω–∞—Ç—ã
                </h2>
                <label class="input-file">
                    üì∑ –ù–∞–∂–º–∏—Ç–µ ¬´–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª¬ª, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
                    <input type="file" id="floorplanFile" accept="image/*" style="display: none;">
                </label>

                <p style="margin: 20px 0; color: #666; font-size: 14px;">
                    üí° –õ–µ–≤—ã–π –∫–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ - –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–Ω–∞—Ç—É
                </p>

                <div class="room-list">
                    <strong>–ö–æ–º–Ω–∞—Ç—ã –Ω–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–µ:</strong>
                    <div class="room-item">
                        <span>–ì–æ—Å—Ç–∏–Ω–∞—è</span>
                        <div class="room-item-count" id="livingRoomCount">0</div>
                        <button type="button" class="option-btn" style="flex: 0; width: 100px; margin: 0; padding: 8px;" onclick="incrementRoom('living_room')">‚ûï</button>
                        <button type="button" class="option-btn" style="flex: 0; width: 100px; margin: 0; padding: 8px;" onclick="decrementRoom('living_room')">‚ûñ</button>
                    </div>
                    <div class="room-item">
                        <span>–°–ø–∞–ª—å–Ω—è</span>
                        <div class="room-item-count" id="bedroomCount">0</div>
                        <button type="button" class="option-btn" style="flex: 0; width: 100px; margin: 0; padding: 8px;" onclick="incrementRoom('bedroom')">‚ûï</button>
                        <button type="button" class="option-btn" style="flex: 0; width: 100px; margin: 0; padding: 8px;" onclick="decrementRoom('bedroom')">‚ûñ</button>
                    </div>
                    <div class="room-item">
                        <span>–ö—É—Ö–Ω—è</span>
                        <div class="room-item-count" id="kitchenCount">0</div>
                        <button type="button" class="option-btn" style="flex: 0; width: 100px; margin: 0; padding: 8px;" onclick="incrementRoom('kitchen')">‚ûï</button>
                        <button type="button" class="option-btn" style="flex: 0; width: 100px; margin: 0; padding: 8px;" onclick="decrementRoom('kitchen')">‚ûñ</button>
                    </div>
                    <div class="room-item">
                        <span>–ö–æ—Ä–∏–¥–æ—Ä</span>
                        <div class="room-item-count" id="hallwayCount">0</div>
                        <button type="button" class="option-btn" style="flex: 0; width: 100px; margin: 0; padding: 8px;" onclick="incrementRoom('hallway')">‚ûï</button>
                        <button type="button" class="option-btn" style="flex: 0; width: 100px; margin: 0; padding: 8px;" onclick="decrementRoom('hallway')">‚ûñ</button>
                    </div>
                    <div class="room-item">
                        <span>–ë–∞–ª–∫–æ–Ω</span>
                        <div class="room-item-count" id="balconyCount">0</div>
                        <button type="button" class="option-btn" style="flex: 0; width: 100px; margin: 0; padding: 8px;" onclick="incrementRoom('balcony')">‚ûï</button>
                        <button type="button" class="option-btn" style="flex: 0; width: 100px; margin: 0; padding: 8px;" onclick="decrementRoom('balcony')">‚ûñ</button>
                    </div>
                    <div class="room-item">
                        <span>–°–∞–Ω—É–∑–µ–ª</span>
                        <div class="room-item-count" id="bathroomCount">0</div>
                        <button type="button" class="option-btn" style="flex: 0; width: 100px; margin: 0; padding: 8px;" onclick="incrementRoom('bathroom')">‚ûï</button>
                        <button type="button" class="option-btn" style="flex: 0; width: 100px; margin: 0; padding: 8px;" onclick="decrementRoom('bathroom')">‚ûñ</button>
                    </div>
                </div>

                <strong>–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ (JSON):</strong>
                <div class="json-output" id="jsonFloorplan">
                    { "rooms": {} }
                </div>

                <div class="navigation">
                    <button class="btn-nav" onclick="prevStep(2)">‚Üê –ù–∞–∑–∞–¥</button>
                    <button class="btn-nav" onclick="nextStep(2)">–î–∞–ª–µ–µ ‚Üí</button>
                </div>
            </div>

            <!-- –®–ê–ì 3: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ -->
            <div id="step3" class="step-card hidden">
                <h2>
                    <span class="step-number">3</span>–î–æ–±–∞–≤—å—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
                </h2>

                <button class="btn btn-primary" onclick="addDevice()" style="margin-bottom: 20px;">
                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
                </button>

                <div class="device-list" id="deviceList">
                    <p style="color: #999; text-align: center;">–ù–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤</p>
                </div>

                <button class="save-btn" onclick="saveConfiguration()">
                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É
                </button>

                <div class="success-message" id="successMessage">
                    ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!
                </div>

                <div class="navigation">
                    <button class="btn-nav" onclick="prevStep(3)" style="flex: 1;">‚Üê –ù–∞–∑–∞–¥</button>
                </div>
            </div>

            <!-- PROGRESS INDICATOR -->
            <div class="step-indicator">
                <p>–®–∞–≥ <span id="currentStep">1</span>/3</p>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8082/api/auth';
        const API_USER_SETUP = 'http://localhost:8082/api/user/setup';

        // ============ AUTHENTICATION ============

        window.addEventListener('load', () => {
            const savedUser = localStorage.getItem('user');
            if (savedUser) {
                showUserPage(JSON.parse(savedUser));
            }
        });

        function toggleForms() {
            document.getElementById('registerCard').classList.toggle('hidden');
            document.getElementById('loginCard').classList.toggle('hidden');
            document.getElementById('registerAlert').innerHTML = '';
            document.getElementById('loginAlert').innerHTML = '';
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const username = document.getElementById('regUsername').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;

            try {
                const response = await fetch(`${API_BASE}/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, email, password })
                });

                const data = await response.json();

                if (!response.ok) {
                    showAlert('registerAlert', data.message || '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏', 'error');
                    return;
                }

                showAlert('registerAlert', '‚úì –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!', 'success');
                localStorage.setItem('user', JSON.stringify(data));
                
                setTimeout(() => {
                    showUserPage(data);
                }, 1000);

            } catch (error) {
                showAlert('registerAlert', '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
            }
        });

        // –í—Ö–æ–¥
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const response = await fetch(`${API_BASE}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (!response.ok) {
                    showAlert('loginAlert', '–ù–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ', 'error');
                    return;
                }

                showAlert('loginAlert', '‚úì –í—Ö–æ–¥ —É—Å–ø–µ—à–µ–Ω!', 'success');
                localStorage.setItem('user', JSON.stringify(data));
                
                setTimeout(() => {
                    showUserPage(data);
                }, 1000);

            } catch (error) {
                showAlert('loginAlert', '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
            }
        });

        function showAlert(elementId, message, type) {
            const alertDiv = document.getElementById(elementId);
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
        }

        // ============ USER PAGE ============

        let currentUser = null;
        let userSetupData = {
            paymentType: '',
            floorplan: null,
            rooms: {},
            devices: []
        };

        function showUserPage(userData) {
            currentUser = userData;
            document.getElementById('authPage').style.display = 'none';
            document.getElementById('userPage').style.display = 'block';
            document.getElementById('userDisplayName').textContent = `üë§ ${userData.username}`;
            showStep(1);
        }

        function logout() {
            localStorage.removeItem('user');
            currentUser = null;
            userSetupData = {
                paymentType: '',
                floorplan: null,
                rooms: {},
                devices: []
            };
            document.getElementById('authPage').style.display = 'flex';
            document.getElementById('userPage').style.display = 'none';
            document.getElementById('registerForm').reset();
            document.getElementById('loginForm').reset();
            document.getElementById('registerCard').classList.remove('hidden');
            document.getElementById('loginCard').classList.add('hidden');
        }

        // –®–ê–ì 1: –í—ã–±–æ—Ä —Ç–∏–ø–∞ —Ä–∞—Å—á–µ—Ç–∞
        function selectPayment(type) {
            userSetupData.paymentType = type;
            document.querySelectorAll('#step1 .option-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent.includes(type));
            });
        }

        // –®–ê–ì 2: –ö–æ–º–Ω–∞—Ç—ã
        function incrementRoom(roomId) {
            userSetupData.rooms[roomId] = (userSetupData.rooms[roomId] || 0) + 1;
            updateRoomCounts();
            updateJsonFloorplan();
        }

        function decrementRoom(roomId) {
            if (userSetupData.rooms[roomId] > 0) {
                userSetupData.rooms[roomId]--;
                updateRoomCounts();
                updateJsonFloorplan();
            }
        }

        function updateRoomCounts() {
            const roomMap = {
                'living_room': 'livingRoomCount',
                'bedroom': 'bedroomCount',
                'kitchen': 'kitchenCount',
                'hallway': 'hallwayCount',
                'balcony': 'balconyCount',
                'bathroom': 'bathroomCount'
            };

            Object.entries(roomMap).forEach(([key, elementId]) => {
                document.getElementById(elementId).textContent = userSetupData.rooms[key] || 0;
            });
        }

        function updateJsonFloorplan() {
            document.getElementById('jsonFloorplan').textContent = 
                JSON.stringify({ rooms: userSetupData.rooms }, null, 2);
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞
        document.getElementById('floorplanFile').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    userSetupData.floorplan = event.target.result;
                    console.log('–ü–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
                };
                reader.readAsDataURL(file);
            }
        });

        // –®–ê–ì 3: –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
        let deviceCounter = 0;

        function addDevice() {
            deviceCounter++;
            const deviceId = `device-${deviceCounter}`;
            userSetupData.devices.push({
                id: deviceId,
                name: '',
                type: '',
                room: ''
            });
            renderDevices();
        }

        function removeDevice(deviceId) {
            userSetupData.devices = userSetupData.devices.filter(d => d.id !== deviceId);
            renderDevices();
        }

        function updateDevice(deviceId, field, value) {
            const device = userSetupData.devices.find(d => d.id === deviceId);
            if (device) {
                device[field] = value;
            }
        }

        function renderDevices() {
            const deviceList = document.getElementById('deviceList');
            
            if (userSetupData.devices.length === 0) {
                deviceList.innerHTML = '<p style="color: #999; text-align: center;">–ù–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤</p>';
                return;
            }

            deviceList.innerHTML = userSetupData.devices.map(device => `
                <div class="device-item">
                    <input 
                        type="text" 
                        placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" 
                        value="${device.name}"
                        onchange="updateDevice('${device.id}', 'name', this.value)"
                    />
                    <select 
                        onchange="updateDevice('${device.id}', 'type', this.value)"
                    >
                        <option value="">–¢–∏–ø</option>
                        <option value="sensor" ${device.type === 'sensor' ? 'selected' : ''}>–î–∞—Ç—á–∏–∫</option>
                        <option value="actuator" ${device.type === 'actuator' ? 'selected' : ''}>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</option>
                        <option value="controller" ${device.type === 'controller' ? 'selected' : ''}>–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä</option>
                    </select>
                    <select 
                        onchange="updateDevice('${device.id}', 'room', this.value)"
                    >
                        <option value="">–ö–æ–º–Ω–∞—Ç–∞</option>
                        <option value="living_room" ${device.room === 'living_room' ? 'selected' : ''}>–ì–æ—Å—Ç–∏–Ω–∞—è</option>
                        <option value="bedroom" ${device.room === 'bedroom' ? 'selected' : ''}>–°–ø–∞–ª—å–Ω—è</option>
                        <option value="kitchen" ${device.room === 'kitchen' ? 'selected' : ''}>–ö—É—Ö–Ω—è</option>
                        <option value="hallway" ${device.room === 'hallway' ? 'selected' : ''}>–ö–æ—Ä–∏–¥–æ—Ä</option>
                        <option value="balcony" ${device.room === 'balcony' ? 'selected' : ''}>–ë–∞–ª–∫–æ–Ω</option>
                        <option value="bathroom" ${device.room === 'bathroom' ? 'selected' : ''}>–°–∞–Ω—É–∑–µ–ª</option>
                    </select>
                    <button type="button" class="device-item-btn" onclick="removeDevice('${device.id}')">
                        –£–¥–∞–ª–∏—Ç—å
                    </button>
                </div>
            `).join('');
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è
        function showStep(stepNum) {
            document.getElementById('step1').classList.toggle('hidden', stepNum !== 1);
            document.getElementById('step2').classList.toggle('hidden', stepNum !== 2);
            document.getElementById('step3').classList.toggle('hidden', stepNum !== 3);
            document.getElementById('currentStep').textContent = stepNum;
        }

        function nextStep(currentStep) {
            if (currentStep === 1) {
                if (!userSetupData.paymentType) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ä–∞—Å—á–µ—Ç–∞');
                    return;
                }
            }
            if (currentStep < 3) {
                showStep(currentStep + 1);
            }
        }

        function prevStep(currentStep) {
            if (currentStep > 1) {
                showStep(currentStep - 1);
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        async function saveConfiguration() {
            if (!currentUser) {
                alert('–í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã');
                return;
            }

            if (userSetupData.devices.length === 0) {
                alert('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ');
                return;
            }

            try {
                const response = await fetch(API_USER_SETUP, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_id: currentUser.id,
                        device_id: 1,
                        payment_type: userSetupData.paymentType,
                        floorplan: JSON.stringify({
                            rooms: userSetupData.rooms,
                            devices: userSetupData.devices
                        })
                    })
                });

                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                }

                const data = await response.json();
                console.log('–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞:', data);
                
                // –ü–æ–∫–∞–∑–∞—Ç—å —É—Å–ø–µ—à–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                const successMsg = document.getElementById('successMessage');
                successMsg.classList.add('show');
                setTimeout(() => {
                    successMsg.classList.remove('show');
                }, 3000);

            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: ' + error.message);
            }
        }
    </script>
</body>
</html>